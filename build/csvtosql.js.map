{
  "version": 3,
  "sources": ["../csvtosql.js"],
  "sourcesContent": ["const { access } = require('fs/promises')\nconst { constants, createReadStream } = require('fs')\nconst split2 = require('split2')\nconst events = require('events')\nconst pkjson = require('./package.json')\nconst emitter = new events.EventEmitter()\nconst fs = require('fs')\n\n;(() => {\n  const ctx = {\n    _init: new Date(),\n    args: process.argv,\n  }\n\n  emitter.on('start', () => console.log('starting conversion'))\n\n  csvtosql.call(ctx)\n})()\n\nasync function csvtosql() {\n  const { args } = this\n\n  const usage = () =>\n    process.stdout.write(` \n\t${pkjson.name} v${pkjson.version}\n\t${pkjson.description}\nUsage:\n  \t--source | -s [dir] select the source file or directory\n  \t--help | -h [dir] get help\n  \t--version | -v [dir] get the current version\n  \t\\n`)\n\n  if (args.length < 3) {\n    usage()\n    process.exit(1)\n  }\n  if (args.find((arg) => arg === '--help' || arg === '-h')) {\n    usage()\n    process.exit(0)\n  }\n\n  if (args.find((arg) => arg === '--version' || arg === '-v')) {\n    process.stdout.write(`${pkjson.name} v${pkjson.version}\\n`)\n    process.exit(0)\n  }\n\n  if (args.find((arg) => arg === '--source' || arg === '-s')) {\n    if (\n      args[args.indexOf('--source') + 1] === undefined ||\n      args[args.indexOf('-s') + 1] === undefined\n    ) {\n      process.stdout.write(\n        `--source | -s [dir] select the source file or directory \\n`\n      )\n    } else if (args[args.indexOf('-s') + 1].endsWith('.csv')) {\n      this.source = args[args.indexOf('-s') + 1]\n      this.tableName = this.source.split('/').pop().split('.')[0].toLowerCase()\n      console.log(`source ${this.source}`)\n    }\n  }\n\n  await access(this.source, constants.R_OK | constants.W_OK).catch((e) => {\n    // new Error to send back stack trace\n    throw new Error(`${this.source} is not readable or writable \\n ${e}\\n`)\n  })\n\n  let count = 0\n  const isEmail = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n  const isNumber = /^[0-9]+$/\n  const isDate = /^\\d{4}-\\d{2}-\\d{2}$/\n  const isTime = /^\\d{2}:\\d{2}:\\d{2}$/\n  const isDateTime = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$/\n  const isBoolean = /^(true|false)$/\n  const isString = /^[^\\s]+$/\n  const isEmpty = /^$/\n\n  createReadStream(this.source)\n    .pipe(split2())\n    .on('data', (line) => {\n      count++\n      if (count === 1) {\n        this.headers = line.split(',').map((col) => {\n          if (col.match(/^[0-9]+$/)) return `${col} INT`\n          if (col.match(/^[0-9]+\\.[0-9]+$/)) return `${col} FLOAT`\n          if (col.match(isEmail)) return `${col.toLowerCase()} TEXT`\n          if (col.match(isNumber)) return `${col} INT`\n          if (col.match(isDate)) return `${col} DATE`\n          if (col.match(isTime)) return `${col} TIME`\n          if (col.match(isDateTime)) return `${col} DATETIME`\n          if (col.match(isBoolean)) return `${col} BOOLEAN`\n          if (col.match(isString)) return `${col.toLowerCase()} TEXT`\n          if (col.match(isEmpty)) return `${col.toLowerCase()} TEXT`\n          return `${col.toLowerCase()} TEXT`\n        })\n      } else {\n        const values = line.split(',').map((val) => {\n          if (val.match(isEmail)) return `'${val}'`\n          if (val.match(isNumber)) return `${val}`\n          if (val.match(isDate)) return `'${val}'`\n          if (val.match(isTime)) return `'${val}'`\n          if (val.match(isDateTime)) return `'${val}'`\n          if (val.match(isBoolean)) return `${val}`\n          if (val.match(isString)) return `'${val}'`\n          if (val.match(isEmpty)) return `NULL`\n          return `'${val}'`\n        })\n        const sql = `INSERT INTO ${this.tableName} (${this.headers.join(\n          ','\n        )}) VALUES (${values.join(',')}); \\n \\n`\n        this.sql += sql\n      }\n    })\n    .on('end', () => {\n      console.log(`File processed ${this.source}`)\n      console.log(`${this.headers.length} headers found`)\n      console.log(`${count} lines processed`)\n      console.log(`${new Date().getTime() - this._init.getTime()} ms elapsed`)\n      const sql = generateSQL()\n\n      fs.writeFile(`./${this.tableName}.sql`, sql, (err) => {\n        if (err) throw err\n        console.log('SQL file created')\n      })\n    })\n    .once('readable', () => {\n      emitter.emit('start')\n    })\n    .on('error', (err) => {\n      throw new Error(err)\n    })\n\n  const generateSQL = () => {\n    const inStatement = `${this.headers.map((h) => `${h}`)}`\n    const create = `CREATE TABLE IF NOT EXISTS ${this.tableName} (${inStatement})`\n    return `${create};\\n${this.sql}`\n  }\n}\n\nmodule.exports = csvtosql\n"],
  "mappings": "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",
  "names": []
}
